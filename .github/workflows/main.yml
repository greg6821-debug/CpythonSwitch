name: Build CPython 3.9 for Nintendo Switch

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    container:
      image: devkitpro/devkita64:20241023

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # üî¥ –í–ê–ñ–ù–û: –î–û–õ–ñ–ù–û –ë–´–¢–¨ –ü–ï–†–í–´–ú –ü–û–°–õ–ï CHECKOUT
      - name: Export devkitA64 env
        run: |
          echo "DEVKITA64=/opt/devkitpro/devkitA64" >> $GITHUB_ENV
          echo "PATH=/opt/devkitpro/devkitA64/bin:$PATH" >> $GITHUB_ENV

      # üîé –ü–†–û–í–ï–†–ö–ê (–¢–ï–ü–ï–†–¨ –°–†–ê–ë–û–¢–ê–ï–¢)
      - name: Toolchain sanity check
        run: |
          echo "DEVKITPRO=$DEVKITPRO"
          echo "DEVKITA64=$DEVKITA64"
          which aarch64-none-elf-gcc
          which elf2nro
          which nacptool

      - name: Setup CPython
        run: ./setup.bash

      - name: Build CPython
        run: ./build.bash

      - name: Build Switch .nro
        run: ./build_switch_app.sh

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: python39-switch
          path: python39-switch/*.nro
