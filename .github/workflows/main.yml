name: Build CPython 3.9 for Nintendo Switch

run-name: ${{ github.actor }} builds CPython 3.9 (.nro) ðŸš€

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    container:
      image: devkitpro/devkita64:20241023

    steps:
      - name: Show DEVKITPRO paths
        run: |
          echo "DEVKITPRO=$DEVKITPRO"
          echo "DEVKITA64=$DEVKITA64"

      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install dependencies
        run: |
          pacman -Sy --noconfirm \
            make \
            patch \
            autoconf \
            automake \
            libtool \
            pkg-config

      - name: Setup CPython for Switch
        run: |
          chmod +x setup.bash
          ./setup.bash

      - name: Build CPython (libpython3.9.a)
        run: |
          chmod +x build.bash
          ./build.bash

      - name: Build Switch .nro
        run: |
          chmod +x build_switch_app.sh
          ./build_switch_app.sh

      - name: Upload python39-switch artifact
        uses: actions/upload-artifact@v4
        with:
          name: python39-switch
          path: python39-switch/*.nro
